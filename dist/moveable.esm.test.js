/*
Copyright (c) 2019 Daybrush
name: moveable
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/moveable.git
version: 0.5.0
*/
"use strict";var EgComponent=require("@egjs/component"),frameworkUtils=require("framework-utils"),utils=require("@daybrush/utils"),drag=require("@daybrush/drag"),extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},VNode=function(){},options={},stack=[],EMPTY_CHILDREN=[];function h(t,e){var n,r,o,i,a=EMPTY_CHILDREN;for(i=arguments.length;2<i--;)stack.push(arguments[i]);for(e&&null!=e.children&&(stack.length||stack.push(e.children),delete e.children);stack.length;)if((r=stack.pop())&&void 0!==r.pop)for(i=r.length;i--;)stack.push(r[i]);else"boolean"==typeof r&&(r=null),(o="function"!=typeof t)&&(null==r?r="":"number"==typeof r?r=String(r):"string"!=typeof r&&(o=!1)),o&&n?a[a.length-1]+=r:a===EMPTY_CHILDREN?a=[r]:a.push(r),n=o;var s=new VNode;return s.nodeName=t,s.children=a,s.attributes=null==e?void 0:e,s.key=null==e?void 0:e.key,void 0!==options.vnode&&options.vnode(s),s}function extend(t,e){for(var n in e)t[n]=e[n];return t}function applyRef(t,e){null!=t&&("function"==typeof t?t(e):t.current=e)}var defer="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,IS_NON_DIMENSIONAL=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,items=[];function enqueueRender(t){!t._dirty&&(t._dirty=!0)&&1==items.push(t)&&defer(rerender)}function rerender(){for(var t;t=items.pop();)t._dirty&&renderComponent(t)}function isSameNodeType(t,e,n){return"string"==typeof e||"number"==typeof e?void 0!==t.splitText:"string"==typeof e.nodeName?!t._componentConstructor&&isNamedNode(t,e.nodeName):n||t._componentConstructor===e.nodeName}function isNamedNode(t,e){return t.normalizedNodeName===e||t.nodeName.toLowerCase()===e.toLowerCase()}function getNodeProps(t){var e=extend({},t.attributes);e.children=t.children;var n=t.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===e[r]&&(e[r]=n[r]);return e}function createNode(t,e){var n=e?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);return n.normalizedNodeName=t,n}function removeNode(t){var e=t.parentNode;e&&e.removeChild(t)}function setAccessor(t,e,n,r,o){if("className"===e&&(e="class"),"key"===e);else if("ref"===e)applyRef(n,null),applyRef(r,t);else if("class"!==e||o)if("style"===e){if(r&&"string"!=typeof r&&"string"!=typeof n||(t.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var i in n)i in r||(t.style[i]="");for(var i in r)t.style[i]="number"==typeof r[i]&&!1===IS_NON_DIMENSIONAL.test(i)?r[i]+"px":r[i]}}else if("dangerouslySetInnerHTML"===e)r&&(t.innerHTML=r.__html||"");else if("o"==e[0]&&"n"==e[1]){var a=e!==(e=e.replace(/Capture$/,""));e=e.toLowerCase().substring(2),r?n||t.addEventListener(e,eventProxy,a):t.removeEventListener(e,eventProxy,a),(t._listeners||(t._listeners={}))[e]=r}else if("list"!==e&&"type"!==e&&!o&&e in t){try{t[e]=null==r?"":r}catch(t){}null!=r&&!1!==r||"spellcheck"==e||t.removeAttribute(e)}else{var s=o&&e!==(e=e.replace(/^xlink:?/,""));null==r||!1===r?s?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.removeAttribute(e):"function"!=typeof r&&(s?t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),r):t.setAttribute(e,r))}else t.className=r||""}function eventProxy(t){return this._listeners[t.type](options.event&&options.event(t)||t)}var mounts=[],diffLevel=0,isSvgMode=!1,hydrating=!1;function flushMounts(){for(var t;t=mounts.shift();)t.componentDidMount&&t.componentDidMount()}function diff(t,e,n,r,o,i){diffLevel++||(isSvgMode=null!=o&&void 0!==o.ownerSVGElement,hydrating=null!=t&&!("__preactattr_"in t));var a=idiff(t,e,n,r,i);return o&&a.parentNode!==o&&o.appendChild(a),--diffLevel||(hydrating=!1,i||flushMounts()),a}function idiff(t,e,n,r,o){var i=t,a=isSvgMode;if(null!=e&&"boolean"!=typeof e||(e=""),"string"==typeof e||"number"==typeof e)return t&&void 0!==t.splitText&&t.parentNode&&(!t._component||o)?t.nodeValue!=e&&(t.nodeValue=e):(i=document.createTextNode(e),t&&(t.parentNode&&t.parentNode.replaceChild(i,t),recollectNodeTree(t,!0))),i.__preactattr_=!0,i;var s=e.nodeName;if("function"==typeof s)return buildComponentFromVNode(t,e,n,r);if(isSvgMode="svg"===s||"foreignObject"!==s&&isSvgMode,s=String(s),(!t||!isNamedNode(t,s))&&(i=createNode(s,isSvgMode),t)){for(;t.firstChild;)i.appendChild(t.firstChild);t.parentNode&&t.parentNode.replaceChild(i,t),recollectNodeTree(t,!0)}var l=i.firstChild,c=i.__preactattr_,p=e.children;if(null==c){c=i.__preactattr_={};for(var u=i.attributes,d=u.length;d--;)c[u[d].name]=u[d].value}return!hydrating&&p&&1===p.length&&"string"==typeof p[0]&&null!=l&&void 0!==l.splitText&&null==l.nextSibling?l.nodeValue!=p[0]&&(l.nodeValue=p[0]):(p&&p.length||null!=l)&&innerDiffNode(i,p,n,r,hydrating||null!=c.dangerouslySetInnerHTML),diffAttributes(i,e.attributes,c),isSvgMode=a,i}function innerDiffNode(t,e,n,r,o){var i,a,s,l,c,p=t.childNodes,u=[],d={},f=0,g=0,m=p.length,h=0,v=e?e.length:0;if(0!==m)for(var b=0;b<m;b++){var y=p[b],x=y.__preactattr_;null!=(M=v&&x?y._component?y._component.__key:x.key:null)?(f++,d[M]=y):(x||(void 0!==y.splitText?!o||y.nodeValue.trim():o))&&(u[h++]=y)}if(0!==v)for(b=0;b<v;b++){var M;if((c=null)!=(M=(l=e[b]).key))f&&void 0!==d[M]&&(c=d[M],d[M]=void 0,f--);else if(g<h)for(i=g;i<h;i++)if(void 0!==u[i]&&isSameNodeType(a=u[i],l,o)){c=a,u[i]=void 0,i===h-1&&h--,i===g&&g++;break}c=idiff(c,l,n,r),s=p[b],c&&c!==t&&c!==s&&(null==s?t.appendChild(c):c===s.nextSibling?removeNode(s):t.insertBefore(c,s))}if(f)for(var b in d)void 0!==d[b]&&recollectNodeTree(d[b],!1);for(;g<=h;)void 0!==(c=u[h--])&&recollectNodeTree(c,!1)}function recollectNodeTree(t,e){var n=t._component;n?unmountComponent(n):(null!=t.__preactattr_&&applyRef(t.__preactattr_.ref,null),!1!==e&&null!=t.__preactattr_||removeNode(t),removeChildren(t))}function removeChildren(t){for(t=t.lastChild;t;){var e=t.previousSibling;recollectNodeTree(t,!0),t=e}}function diffAttributes(t,e,n){var r;for(r in n)e&&null!=e[r]||null==n[r]||setAccessor(t,r,n[r],n[r]=void 0,isSvgMode);for(r in e)"children"===r||"innerHTML"===r||r in n&&e[r]===("value"===r||"checked"===r?t[r]:n[r])||setAccessor(t,r,n[r],n[r]=e[r],isSvgMode)}var recyclerComponents=[];function createComponent(t,e,n){var r,o=recyclerComponents.length;for(t.prototype&&t.prototype.render?(r=new t(e,n),Component.call(r,e,n)):((r=new Component(e,n)).constructor=t,r.render=doRender);o--;)if(recyclerComponents[o].constructor===t)return r.nextBase=recyclerComponents[o].nextBase,recyclerComponents.splice(o,1),r;return r}function doRender(t,e,n){return this.constructor(t,n)}function setComponentProps(t,e,n,r,o){t._disable||(t._disable=!0,t.__ref=e.ref,t.__key=e.key,delete e.ref,delete e.key,void 0===t.constructor.getDerivedStateFromProps&&(!t.base||o?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(e,r)),r&&r!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=r),t.prevProps||(t.prevProps=t.props),t.props=e,t._disable=!1,0!==n&&(1!==n&&!1===options.syncComponentUpdates&&t.base?enqueueRender(t):renderComponent(t,1,o)),applyRef(t.__ref,t))}function renderComponent(t,e,n,r){if(!t._disable){var o,i,a,s=t.props,l=t.state,c=t.context,p=t.prevProps||s,u=t.prevState||l,d=t.prevContext||c,f=t.base,g=t.nextBase,m=f||g,h=t._component,v=!1,b=d;if(t.constructor.getDerivedStateFromProps&&(l=extend(extend({},l),t.constructor.getDerivedStateFromProps(s,l)),t.state=l),f&&(t.props=p,t.state=u,t.context=d,2!==e&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(s,l,c)?v=!0:t.componentWillUpdate&&t.componentWillUpdate(s,l,c),t.props=s,t.state=l,t.context=c),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!v){o=t.render(s,l,c),t.getChildContext&&(c=extend(extend({},c),t.getChildContext())),f&&t.getSnapshotBeforeUpdate&&(b=t.getSnapshotBeforeUpdate(p,u));var y,x,M=o&&o.nodeName;if("function"==typeof M){var S=getNodeProps(o);(i=h)&&i.constructor===M&&S.key==i.__key?setComponentProps(i,S,1,c,!1):(y=i,t._component=i=createComponent(M,S,c),i.nextBase=i.nextBase||g,i._parentComponent=t,setComponentProps(i,S,0,c,!1),renderComponent(i,1,n,!0)),x=i.base}else a=m,(y=h)&&(a=t._component=null),!m&&1!==e||(a&&(a._component=null),x=diff(a,o,c,n||!f,m&&m.parentNode,!0));if(m&&x!==m&&i!==h){var _=m.parentNode;_&&x!==_&&(_.replaceChild(x,m),y||(m._component=null,recollectNodeTree(m,!1)))}if(y&&unmountComponent(y),(t.base=x)&&!r){for(var C=t,P=t;P=P._parentComponent;)(C=P).base=x;x._component=C,x._componentConstructor=C.constructor}}for(!f||n?mounts.push(t):v||t.componentDidUpdate&&t.componentDidUpdate(p,u,b);t._renderCallbacks.length;)t._renderCallbacks.pop().call(t);diffLevel||r||flushMounts()}}function buildComponentFromVNode(t,e,n,r){for(var o=t&&t._component,i=o,a=t,s=o&&t._componentConstructor===e.nodeName,l=s,c=getNodeProps(e);o&&!l&&(o=o._parentComponent);)l=o.constructor===e.nodeName;return o&&l&&(!r||o._component)?(setComponentProps(o,c,3,n,r),t=o.base):(i&&!s&&(unmountComponent(i),t=a=null),o=createComponent(e.nodeName,c,n),t&&!o.nextBase&&(o.nextBase=t,a=null),setComponentProps(o,c,1,n,r),t=o.base,a&&t!==a&&(a._component=null,recollectNodeTree(a,!1))),t}function unmountComponent(t){var e=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var n=t._component;n?unmountComponent(n):e&&(null!=e.__preactattr_&&applyRef(e.__preactattr_.ref,null),removeNode(t.nextBase=e),recyclerComponents.push(t),removeChildren(e)),applyRef(t.__ref,null)}function Component(t,e){this._dirty=!0,this.context=e,this.props=t,this.state=this.state||{},this._renderCallbacks=[]}function render(t,e,n){return diff(n,t,{},!1,e,!1)}extend(Component.prototype,{setState:function(t,e){this.prevState||(this.prevState=this.state),this.state=extend(extend({},this.state),"function"==typeof t?t(this.state,this.props):t),e&&this._renderCallbacks.push(e),enqueueRender(this)},forceUpdate:function(t){t&&this._renderCallbacks.push(t),renderComponent(this,2)},render:function(){}});var __extends$1=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),ELEMENTS="a abbr address area article aside audio b base bdi bdo big blockquote body br button canvas caption cite code col colgroup data datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd keygen label legend li link main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param picture pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td textarea tfoot th thead time title tr track u ul var video wbr circle clipPath defs ellipse g image line linearGradient mask path pattern polygon polyline radialGradient rect stop svg text tspan".split(" "),REACT_ELEMENT_TYPE="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,COMPONENT_WRAPPER_KEY="undefined"!=typeof Symbol&&Symbol.for?Symbol.for("__preactCompatWrapper"):"__preactCompatWrapper",AUTOBIND_BLACKLIST={constructor:1,render:1,shouldComponentUpdate:1,componentWillReceiveProps:1,componentWillUpdate:1,componentDidUpdate:1,componentWillMount:1,componentDidMount:1,componentWillUnmount:1,componentDidUnmount:1},CAMEL_PROPS=/^(?:accent|alignment|arabic|baseline|cap|clip|color|fill|flood|font|glyph|horiz|marker|overline|paint|stop|strikethrough|stroke|text|underline|unicode|units|v|vector|vert|word|writing|x)[A-Z]/,BYPASS_HOOK={},DEV=!1;try{DEV="production"!==process.env.NODE_ENV}catch(t){}var VNode$1=h("a",null).constructor;VNode$1.prototype.$$typeof=REACT_ELEMENT_TYPE,VNode$1.prototype.preactCompatUpgraded=!1,VNode$1.prototype.preactCompatNormalized=!1,Object.defineProperty(VNode$1.prototype,"type",{get:function(){return this.nodeName},set:function(t){this.nodeName=t},configurable:!0}),Object.defineProperty(VNode$1.prototype,"props",{get:function(){return this.attributes},set:function(t){this.attributes=t},configurable:!0});var oldEventHook=options.event;options.event=function(t){return oldEventHook&&(t=oldEventHook(t)),t.persist=Object,t.nativeEvent=t};var oldVnodeHook=options.vnode;function handleComponentVNode(t){var e=t.nodeName,n=t.attributes;t.attributes={},e.defaultProps&&extend$1(t.attributes,e.defaultProps),n&&extend$1(t.attributes,n)}function handleElementVNode(t,e){var n,r,o;if(e){for(o in e)if(n=CAMEL_PROPS.test(o))break;if(n)for(o in r=t.attributes={},e)e.hasOwnProperty(o)&&(r[CAMEL_PROPS.test(o)?o.replace(/([A-Z0-9])/,"-$1").toLowerCase():o]=e[o])}}options.vnode=function(t){if(!t.preactCompatUpgraded){t.preactCompatUpgraded=!0;var e=t.nodeName,n=t.attributes=null==t.attributes?{}:extend$1({},t.attributes);"function"==typeof e?(!0===e[COMPONENT_WRAPPER_KEY]||e.prototype&&"isReactComponent"in e.prototype)&&(t.children&&""===String(t.children)&&(t.children=void 0),t.children&&(n.children=t.children),t.preactCompatNormalized||normalizeVNode(t),handleComponentVNode(t)):(t.children&&""===String(t.children)&&(t.children=void 0),t.children&&(n.children=t.children),n.defaultValue&&(n.value||0===n.value||(n.value=n.defaultValue),delete n.defaultValue),handleElementVNode(t,n))}oldVnodeHook&&oldVnodeHook(t)};var ContextProvider=function(){};ContextProvider.prototype.getChildContext=function(){return this.props.context},ContextProvider.prototype.render=function(t){return t.children[0]};var currentComponent,ARR=[];function createFactory(t){return createElement.bind(null,t)}for(var DOM={},i=ELEMENTS.length;i--;)DOM[ELEMENTS[i]]=createFactory(ELEMENTS[i]);function upgradeToVNodes(t,e){for(var n=e||0;n<t.length;n++){var r=t[n];Array.isArray(r)?upgradeToVNodes(r):r&&"object"==typeof r&&!isValidElement(r)&&(r.props&&r.type||r.attributes&&r.nodeName||r.children)&&(t[n]=createElement(r.type||r.nodeName,r.props||r.attributes,r.children))}}function isStatelessComponent(t){return"function"==typeof t&&!(t.prototype&&t.prototype.render)}function wrapStatelessComponent(t){return createClass({displayName:t.displayName||t.name,render:function(){return t(this.props,this.context)}})}function statelessComponentHook(t){var e=t[COMPONENT_WRAPPER_KEY];return e?!0===e?t:e:(e=wrapStatelessComponent(t),Object.defineProperty(e,COMPONENT_WRAPPER_KEY,{configurable:!0,value:!0}),e.displayName=t.displayName,e.propTypes=t.propTypes,e.defaultProps=t.defaultProps,Object.defineProperty(t,COMPONENT_WRAPPER_KEY,{configurable:!0,value:e}),e)}function createElement(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return upgradeToVNodes(t,2),normalizeVNode(h.apply(void 0,t))}function normalizeVNode(t){t.preactCompatNormalized=!0,applyClassName(t),isStatelessComponent(t.nodeName)&&(t.nodeName=statelessComponentHook(t.nodeName));var e=t.attributes.ref,n=e&&typeof e;return!currentComponent||"string"!==n&&"number"!==n||(t.attributes.ref=createStringRefProxy(e,currentComponent)),applyEventNormalization(t),t}function isValidElement(t){return t&&(t instanceof VNode$1||t.$$typeof===REACT_ELEMENT_TYPE)}function createStringRefProxy(e,n){return n._refProxies[e]||(n._refProxies[e]=function(t){n&&n.refs&&null===(n.refs[e]=t)&&(delete n._refProxies[e],n=null)})}function applyEventNormalization(t){var e=t.nodeName,n=t.attributes;if(n&&"string"==typeof e){var r={};for(var o in n)r[o.toLowerCase()]=o;if(r.ondoubleclick&&(n.ondblclick=n[r.ondoubleclick],delete n[r.ondoubleclick]),r.onchange&&("textarea"===e||"input"===e.toLowerCase()&&!/^fil|che|rad/i.test(n.type))){var i=r.oninput||"oninput";n[i]||(n[i]=multihook([n[i],n[r.onchange]]),delete n[r.onchange])}}}function applyClassName(t){var e=t.attributes||(t.attributes={});classNameDescriptor.enumerable="className"in e,e.className&&(e.class=e.className),Object.defineProperty(e,"className",classNameDescriptor)}var classNameDescriptor={configurable:!0,get:function(){return this.class},set:function(t){this.class=t}};function extend$1(t,e){for(var n=arguments,r=1,o=void 0;r<arguments.length;r++)if(o=n[r])for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i]);return t}function shallowDiffers(t,e){for(var n in t)if(!(n in e))return!0;for(var r in e)if(t[r]!==e[r])return!0;return!1}function findDOMNode(t){return t&&(t.base||1===t.nodeType&&t)||null}function F(){}function createClass(t){function e(t,e){bindAll(this),Component$1.call(this,t,e,BYPASS_HOOK),newComponentHook.call(this,t,e)}return(t=extend$1({constructor:e},t)).mixins&&applyMixins(t,collateMixins(t.mixins)),t.statics&&extend$1(e,t.statics),t.propTypes&&(e.propTypes=t.propTypes),t.defaultProps&&(e.defaultProps=t.defaultProps),t.getDefaultProps&&(e.defaultProps=t.getDefaultProps.call(e)),F.prototype=Component$1.prototype,e.prototype=extend$1(new F,t),e.displayName=t.displayName||"Component",e}function collateMixins(t){for(var e={},n=0;n<t.length;n++){var r=t[n];for(var o in r)r.hasOwnProperty(o)&&"function"==typeof r[o]&&(e[o]||(e[o]=[])).push(r[o])}return e}function applyMixins(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=multihook(e[n].concat(t[n]||ARR),"getDefaultProps"===n||"getInitialState"===n||"getChildContext"===n))}function bindAll(t){for(var e in t){var n=t[e];"function"!=typeof n||n.__bound||AUTOBIND_BLACKLIST.hasOwnProperty(e)||((t[e]=n.bind(t)).__bound=!0)}}function callMethod(t,e,n){if("string"==typeof e&&(e=t.constructor.prototype[e]),"function"==typeof e)return e.apply(t,n)}function multihook(i,a){return function(){for(var t,e=arguments,n=0;n<i.length;n++){var r=callMethod(this,i[n],e);if(a&&null!=r)for(var o in t=t||{},r)r.hasOwnProperty(o)&&(t[o]=r[o]);else void 0!==r&&(t=r)}return t}}function newComponentHook(t,e){propsHook.call(this,t,e),this.componentWillReceiveProps=multihook([propsHook,this.componentWillReceiveProps||"componentWillReceiveProps"]),this.render=multihook([propsHook,beforeRender,this.render||"render",afterRender])}function propsHook(t,e){if(t){var n=t.children;if(n&&Array.isArray(n)&&1===n.length&&("string"==typeof n[0]||"function"==typeof n[0]||n[0]instanceof VNode$1)&&(t.children=n[0],t.children&&"object"==typeof t.children&&(t.children.length=1,t.children[0]=t.children)),DEV){var r="function"==typeof this?this:this.constructor;this.propTypes||r.propTypes,this.displayName||r.name}}}function beforeRender(t){currentComponent=this}function afterRender(){currentComponent===this&&(currentComponent=null)}function Component$1(t,e,n){Component.call(this,t,e),this.state=this.getInitialState?this.getInitialState():{},this.refs={},this._refProxies={},n!==BYPASS_HOOK&&newComponentHook.call(this,t,e)}function PureComponent(t,e){Component$1.call(this,t,e)}function splitComma(t){var e=t.match(/("[^"]*"|'[^']*'|[^,\s()]*\((?:[^()]*|\([^()]*\))*\)[^,\s()]*|[^,])+/g);return e?e.map(function(t){return t.trim()}):[]}extend$1(Component$1.prototype=new Component,{constructor:Component$1,isReactComponent:{},replaceState:function(t,e){for(var n in this.setState(t,e),this.state)n in t||delete this.state[n]},getDOMNode:function(){return this.base},isMounted:function(){return!!this.base}}),F.prototype=Component$1.prototype,PureComponent.prototype=new F,PureComponent.prototype.isPureReactComponent=!0,PureComponent.prototype.shouldComponentUpdate=function(t,e){return shallowDiffers(this.props,t)||shallowDiffers(this.state,e)};var extendStatics$1=function(t,e){return(extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends$2(t,e){function n(){this.constructor=t}extendStatics$1(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var __assign$1=function(){return(__assign$1=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function __rest(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function hash(t){for(var e=5381,n=t.length;n;)e=33*e^t.charCodeAt(--n);return e>>>0}var stringHash=hash;function getHash(t){return stringHash(t).toString(36)}function injectStyle(n,t){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t.replace(/([^}{]*){/gm,function(t,e){return splitComma(e).map(function(t){return-1<t.indexOf(":host")?""+t.replace(/\:host/g,"."+n):"."+n+" "+t}).join(", ")+"{"}),(document.head||document.body).appendChild(e),e}function styled(r,n){var o,i="rCS"+getHash(n),a=0;return function(e){function t(t){return e.call(this,t)||this}return __extends$2(t,e),t.prototype.render=function(){var t=this.props,e=t.className,n=__rest(t,["className"]);return createElement(r,__assign$1({className:e+" "+i},n))},t.prototype.componentDidMount=function(){0===a&&(o=injectStyle(i,n)),++a},t.prototype.componentWillUnmount=function(){0===--a&&o&&o.parentNode.removeChild(o)},t.prototype.getElement=function(){return this.element||(this.element=findDOMNode(this))},t}(Component$1)}var extendStatics$2=function(t,e){return(extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends$3(t,e){function n(){this.constructor=t}extendStatics$2(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var PREFIX="moveable-",MOVEABLE_CSS=frameworkUtils.prefixCSS(PREFIX,"\n{\n    position: fixed;\n    width: 0;\n    height: 0;\n    left: 0;\n    top: 0;\n    z-index: 3000;\n}\n.line, .control {\n    left: 0;\n    top: 0;\n}\n.control {\n    position: absolute;\n    width: 14px;\n    height: 14px;\n    border-radius: 50%;\n    border: 2px solid #fff;\n    box-sizing: border-box;\n    background: #4af;\n    margin-top: -7px;\n    margin-left: -7px;\n}\n.line {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    background: #4af;\n    transform-origin: 0px 0.5px;\n}\n.line.rotation {\n    height: 40px;\n    width: 1px;\n    transform-origin: 0.5px 39.5px;\n}\n.line.rotation .control {\n    border-color: #4af;\n    background:#fff;\n    cursor: alias;\n}\n.control.origin {\n    border-color: #f55;\n    background: #fff;\n    width: 12px;\n    height: 12px;\n    margin-top: -6px;\n    margin-left: -6px;\n    pointer-events: none;\n}\n.control.e, .control.w {\n    cursor: ew-resize;\n}\n.control.s, .control.n {\n    cursor: ns-resize;\n}\n.control.nw, .control.se, :host.reverse .control.ne, :host.reverse .control.sw {\n    cursor: nwse-resize;\n}\n.control.ne, .control.sw, :host.reverse .control.nw, :host.reverse .control.se {\n    cursor: nesw-resize;\n}\n"),NEARBY_POS=[[0,1,2],[1,0,3],[2,0,3],[3,1,2]],MIN_SCALE=1e-9;function add(t,e,n,r,o,i){for(var a=n;a<r;++a)t[a]+=t[o+a-n]*i,e[a]+=e[o+a-n]*i}function swap(t,e,n,r,o){for(var i=n;i<r;++i){var a=t[i],s=e[i];t[i]=t[o+i-n],t[o+i-n]=a,e[i]=e[o+i-n],e[o+i-n]=s}}function divide(t,e,n,r,o){for(var i=n;i<r;++i)t[i]/=o,e[i]/=o}function createIdentityMatrix(t){for(var e=t*t,n=[],r=0;r<e;++r)n[r]=r%(t+1)?0:1;return n}function createOriginMatrix(t,e){for(var n=createIdentityMatrix(e),r=Math.min(t.length,e-1),o=0;o<r;++o)n[e*(o+1)-1]=t[o];return n}function ignoreDimension(t,e,n){void 0===n&&(n=Math.sqrt(t.length));for(var r=t.slice(),o=0;o<n;++o)r[o*n+e-1]=0,r[(e-1)*n+o]=0;return r[(e-1)*(n+1)]=1,r}function invert(t,e){void 0===e&&(e=Math.sqrt(t.length));for(var n=t.slice(),r=createIdentityMatrix(e),o=0;o<e;++o){var i=e*o,a=e*(o+1),s=i+o;if(0===n[s])for(var l=o+1;l<e;++l)if(n[e*l+o]){swap(n,r,i,a,e*l);break}if(!n[s])return[];divide(n,r,i,a,n[s]);for(l=0;l<e;++l){var c=e*l,p=c+e,u=n[c+o];0!==u&&o!==l&&add(n,r,c,p,i,-u)}}return r}function transpose(t,e){void 0===e&&(e=Math.sqrt(t.length));for(var n=[],r=0;r<e;++r)for(var o=0;o<e;++o)n[o*e+r]=t[e*r+o];return n}function convertPositionMatrix(t,e){for(var n=t.slice(),r=t.length;r<e-1;++r)n[r]=0;return n[e-1]=1,n}function convertDimension(t,e,n){if(void 0===e&&(e=Math.sqrt(t.length)),e===n)return t;for(var r=createIdentityMatrix(n),o=Math.min(e,n),i=0;i<o-1;++i){for(var a=0;a<o-1;++a)r[i*n+a]=t[i*e+a];r[(i+1)*n-1]=t[(i+1)*e-1],r[(n-1)*n+i]=t[(e-1)*e+i]}return r[n*n-1]=t[e*e-1],r}function multiplies(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=createIdentityMatrix(e);return t.forEach(function(t){r=multiply(r,t,e)}),r}function multiply(t,e,n){for(var r=[],o=t.length/n,i=e.length/o,a=0;a<n;++a)for(var s=0;s<i;++s)for(var l=r[a*i+s]=0;l<o;++l)r[a*i+s]+=t[a*o+l]*e[l*i+s];return r}function multiplyCSS(t,e,n){void 0===n&&(n=Math.sqrt(t.length));for(var r=[],o=t.length/n,i=e.length/o,a=0;a<n;++a)for(var s=0;s<i;++s)for(var l=r[a+s*i]=0;l<o;++l)r[a+s*i]+=t[a+l*o]*e[l+s*i];return r}function sum(t,e){for(var n=Math.min(t.length,e.length),r=t.slice(),o=0;o<n;++o)r[o]=r[o]+e[o];return r}function minus(t,e){for(var n=Math.min(t.length,e.length),r=t.slice(),o=0;o<n;++o)r[o]=r[o]-e[o];return r}function caculate(t,e,n){void 0===n&&(n=e.length);var r=multiply(t,e,n),o=r[n-1];return r.map(function(t){return t/o})}function convertCSStoMatrix(t){return 6===t.length?[t[0],t[2],t[4],t[1],t[3],t[5],0,0,1]:transpose(t)}function convertMatrixtoCSS(t){return 9===t.length?[t[0],t[3],t[1],t[4],t[2],t[5]]:transpose(t)}function prefix(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return frameworkUtils.prefixNames.apply(void 0,[PREFIX].concat(t))}function getTransformMatrix(t){return"none"===t?[1,0,0,1,0,0]:utils.isObject(t)?t:utils.splitBracket(t).value.split(/s*,\s*/g).map(function(t){return parseFloat(t)})}function getAbsoluteMatrix(t,e,n){return multiplies(e,createOriginMatrix(n,e),t,createOriginMatrix(n.map(function(t){return-t}),e))}function caculateMatrixStack(t,r,e,n,o){void 0===e&&(e=t===r);for(var i,a,s=t,l=[],c=!1,p=3;s&&(e||s!==r);){var u=window.getComputedStyle(s),d=convertCSStoMatrix(getTransformMatrix(u.transform));if(!c&&16===d.length){c=!0,p=4;for(var f=l.length,g=0;g<f;++g)l[g]=convertDimension(l[g],3,4)}c&&9===d.length&&(d=convertDimension(d,3,4));var m=u.transformOrigin.split(" ").map(function(t){return parseFloat(t)});a=a||d,i=i||m,l.push(getAbsoluteMatrix(d,p,m));var h=s.offsetLeft,v=utils.isUndefined(h);if(l.push(createOriginMatrix([v?s:h,v?m:s.offsetTop],p)),e)break;s=s.parentElement}var b=n?convertDimension(n,o,p):createIdentityMatrix(p),y=createIdentityMatrix(p),x=l.length;l.reverse(),l.forEach(function(t,e){var n;x-2===e&&(y=b.slice()),utils.isObject(t[p-1])&&(n=getSVGOffset(t[p-1],r,p,t[2*p-1],b,l[e+1]),t[p-1]=n[0],t[2*p-1]=n[1]),b=multiply(b,t,p)});var M=(c?"matrix3d":"matrix")+"("+convertMatrixtoCSS(a)+")";return[y,b,a,M,i]}function getSVGOffset(t,e,n,r,o,i){for(var a,s=getSize(t),l=s[0],c=s[1],p=(e||document.documentElement).getBoundingClientRect(),u=t.getBoundingClientRect(),d=u.left-p.left,f=u.top-p.top,g=u.width,m=u.height,h=multiplies(n,o,i),v=caculate(h,convertPositionMatrix([0,0],n),n),b=caculate(h,convertPositionMatrix([l,0],n),n),y=caculate(h,convertPositionMatrix([0,c],n),n),x=caculate(h,convertPositionMatrix([l,c],n),n),M=caculate(h,convertPositionMatrix(r,n),n),S=Math.min(v[0],b[0],y[0],x[0]),_=Math.min(v[1],b[1],y[1],x[1]),C=minus(M,[S,_]),P=Math.max(v[0],b[0],y[0],x[0])-S,N=Math.max(v[1],b[1],y[1],x[1])-_,E=[d+C[0]*g/P,f+C[1]*m/N],D=[0,0],R=0;++R<10;){a=minus(caculate(invert(o,n),convertPositionMatrix(E,n),n),caculate(invert(o,n),convertPositionMatrix(M,n),n)),D[0]=a[0],D[1]=a[1];var w=multiplies(n,o,createOriginMatrix(D,n),i),O=caculate(w,convertPositionMatrix([0,0],n),n),k=caculate(w,convertPositionMatrix([l,0],n),n),T=caculate(w,convertPositionMatrix([0,c],n),n),Y=caculate(w,convertPositionMatrix([l,c],n),n),A=Math.min(O[0],k[0],T[0],Y[0])-d,z=Math.min(O[1],k[1],T[1],Y[1])-f;if(Math.abs(A)<2&&Math.abs(z)<2)break;E[0]-=A,E[1]-=z}return D.map(function(t){return Math.round(t)})}function caculatePosition(t,e,n,r){var o=16===t.length?4:3,i=caculate(t,convertPositionMatrix([0,0],o),o),a=i[0],s=i[1],l=caculate(t,convertPositionMatrix([n,0],o),o),c=l[0],p=l[1],u=caculate(t,convertPositionMatrix([0,r],o),o),d=u[0],f=u[1],g=caculate(t,convertPositionMatrix([n,r],o),o),m=g[0],h=g[1],v=caculate(t,convertPositionMatrix(e,o),o),b=v[0],y=v[1],x=Math.min(a,c,d,m),M=Math.min(s,p,f,h);return[[x,M],[b=b-x||0,y=y-M||0],[a=a-x||0,s=s-M||0],[c=c-x||0,p=p-M||0],[d=d-x||0,f=f-M||0],[m=m-x||0,h=h-M||0]]}function rotateMatrix(t,e){var n=Math.cos(e),r=Math.sin(e);return multiply([n,-r,0,r,n,0,0,0,1],t,3)}function getRad(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=Math.atan2(r,n);return 0<o?o:o+2*Math.PI}function getLineStyle(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=Math.sqrt(n*n+r*r),i=getRad(t,e);return{transform:"translate("+t[0]+"px, "+t[1]+"px) rotate("+i+"rad)",width:o+"px"}}function getControlTransform(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.length;return{transform:"translate("+t.reduce(function(t,e){return t+e[0]},0)/n+"px, "+t.reduce(function(t,e){return t+e[1]},0)/n+"px)"}}function getSize(t,e,n,r){void 0===e&&(e=window.getComputedStyle(t)),void 0===r&&(r=n||"border-box"===e.boxSizing);var o=t.offsetWidth,i=t.offsetHeight,a=!utils.isUndefined(o);return(n||r)&&a?[o,i]:(o=t.clientWidth,i=t.clientHeight,n||r?[o+(parseFloat(e.borderLeftWidth)||0)+(parseFloat(e.borderRightWidth)||0),i+(parseFloat(e.borderTopWidth)||0)+(parseFloat(e.borderBottomWidth)||0)]:[o-(parseFloat(e.paddingLeft)||0)-(parseFloat(e.paddingRight)||0),i-(parseFloat(e.paddingTop)||0)-(parseFloat(e.paddingBottom)||0)])}function getRotationInfo(t,e,n,r){var o=[(t[0]+e[0]+n[0]+r[0])/4,(t[1]+e[1]+n[1]+r[1])/4],i=getRad(o,t),a=getRad(o,e),s=i<a&&a-i<Math.PI||a<i&&a-i<-Math.PI?1:-1,l=getRad(0<s?t:e,0<s?e:t),c=rotateMatrix([0,-40,0],l);return[s,l,[(t[0]+e[0])/2+c[0],(t[1]+e[1])/2+c[1]]]}function getTargetInfo(t,e){var n,r,o,i,a,s=0,l=0,c=[0,0],p=[0,0],u=[0,0],d=[0,0],f=[0,0],g=createIdentityMatrix(3),m=createIdentityMatrix(3),h=createIdentityMatrix(3),v=0,b=0,y=[0,0],x=1,M=[0,0],S=0,_=!1,C="";if(t){var P=window.getComputedStyle(t);v=t.offsetWidth,b=t.offsetHeight,utils.isUndefined(v)&&(v=(n=getSize(t,P,!0))[0],b=n[1]),g=(r=caculateMatrixStack(t,e))[0],m=r[1],h=r[2],C=r[3],y=r[4],_=16===m.length,s=(i=(o=caculatePosition(m,y,v,b))[0])[0],l=i[1],c=o[1],x=(a=getRotationInfo(p=o[2],u=o[3],d=o[4],f=o[5]))[0],S=a[1],M=a[2]}return{direction:x,rotationRad:S,rotationPos:M,target:t,left:s,top:l,pos1:p,pos2:u,pos3:d,pos4:f,width:v,height:b,beforeMatrix:g,matrix:m,targetTransform:C,targetMatrix:h,is3d:_,origin:c,transformOrigin:y}}function getPosition(t){var e=t.getAttribute("data-position");if(e){var n=[0,0];return-1<e.indexOf("w")&&(n[0]=-1),-1<e.indexOf("e")&&(n[0]=1),-1<e.indexOf("n")&&(n[1]=-1),-1<e.indexOf("s")&&(n[1]=1),n}}function throttle(t,e){return e?Math.round(t/e)*e:t}function throttleArray(n,r){n.forEach(function(t,e){n[e]=throttle(n[e],r)})}function warp(t,e,n,r,o,i,a,s){var l=t[0],c=t[1],p=e[0],u=e[1],d=n[0],f=n[1],g=r[0],m=r[1],h=o[0],v=o[1],b=i[0],y=i[1],x=a[0],M=a[1],S=s[0],_=s[1],C=invert([l,c,1,0,0,0,-h*l,-h*c,0,0,0,l,c,1,-v*l,-v*c,p,u,1,0,0,0,-b*p,-b*u,0,0,0,p,u,1,-y*p,-y*u,d,f,1,0,0,0,-x*d,-x*f,0,0,0,d,f,1,-M*d,-M*f,g,m,1,0,0,0,-S*g,-S*m,0,0,0,g,m,1,-_*g,-_*m],8);if(!C.length)return[];var P=multiply(C,[h,v,b,y,x,M,S,_],8);return P[8]=1,convertDimension(P,3,4)}function dragStart(t,e){var n=e.datas,r=t.state,o=r.matrix,i=r.beforeMatrix,a=r.is3d,s=r.left,l=r.top,c=r.origin,p=a?4:3;n.is3d=a,n.matrix=o,n.inverseMatrix=invert(o,p),n.beforeMatrix=i,n.inverseBeforeMatrix=invert(i,p),n.absoluteOrigin=convertPositionMatrix(sum([s,l],c),p),n.startDragBeforeDist=caculate(n.inverseBeforeMatrix,n.absoluteOrigin,a?4:3),n.startDragDist=caculate(n.inverseMatrix,n.absoluteOrigin,a?4:3)}function getDragDist(t,e){var n=t.datas,r=t.distX,o=t.distY,i=n.inverseBeforeMatrix,a=n.inverseMatrix,s=n.is3d,l=n.startDragBeforeDist,c=n.startDragDist,p=s?4:3;return minus(caculate(e?i:a,sum(n.absoluteOrigin,[r,o]),p),e?l:c)}function getDraggableDragger(y,x){return drag.drag(x,{container:window,dragstart:function(t){var e=t.datas,n=t.clientX,r=t.clientY,o=window.getComputedStyle(x),i=y.state.targetTransform;return e.left=parseFloat(o.left||"")||0,e.top=parseFloat(o.top||"")||0,e.bottom=parseFloat(o.bottom||"")||0,e.right=parseFloat(o.right||"")||0,e.transform=i,dragStart(y,{datas:e}),e.prevDist=[0,0],e.prevBeforeDist=[0,0],y.props.onDragStart({target:x,clientX:n,clientY:r})},drag:function(t){var e=t.datas,n=t.distX,r=t.distY,o=t.clientX,i=t.clientY,a=y.props.throttleDrag,s=e.prevDist,l=e.prevBeforeDist,c=e.transform,p=getDragDist({datas:e,distX:n,distY:r},!0),u=getDragDist({datas:e,distX:n,distY:r},!1);throttleArray(u,a),throttleArray(p,a);var d=minus(u,s),f=minus(p,l);e.prevDist=u,e.prevBeforeDist=p;var g=e.left+p[0],m=e.top+p[1],h=e.right-p[0],v=e.bottom-p[1],b=c+" translate("+u[0]+"px, "+u[1]+"px)";d.every(function(t){return!t})&&f.some(function(t){return!t})||(y.props.onDrag({target:x,transform:b,dist:u,delta:d,beforeDist:p,beforeDelta:f,left:g,top:m,right:h,bottom:v,clientX:o,clientY:i}),y.updateTarget())},dragend:function(t){var e=t.isDrag,n=t.clientX,r=t.clientY;y.props.onDragEnd({target:x,isDrag:e,clientX:n,clientY:r}),e&&y.updateRect()}})}function scaleStart(t,e,n){var r=n.datas,o=n.clientX,i=n.clientY,a=t.props.target;if(!e||!a)return!1;var s=t.state,l=s.width,c=s.height,p=s.targetTransform;dragStart(t,{datas:r}),r.transform=p,r.prevDist=[1,1],r.position=e,r.width=l,r.height=c,t.props.onScaleStart({target:a,clientX:o,clientY:i})}function scale(t,e){var n=e.datas,r=e.clientX,o=e.clientY,i=e.distX,a=e.distY,s=n.prevDist,l=n.position,c=n.width,p=n.height,u=n.transform,d=getDragDist({datas:n,distX:i,distY:a}),f=l[0]*d[0],g=l[1]*d[1];if(t.props.keepRatio&&l[0]&&l[1]&&c&&p){var m=Math.sqrt(f*f+g*g),h=getRad([0,0],d),v=getRad([0,0],l),b=Math.cos(h-v)*m;g=(f=b)*p/c}var y=(c+f)/c,x=(p+g)/p,M=t.props.target,S=t.props.throttleScale;y=throttle(y,S),x=throttle(x,S),0===y&&(y=(0<s[0]?1:-1)*MIN_SCALE),0===x&&(x=(0<s[1]?1:-1)*MIN_SCALE),n.prevDist=[y,x],y===s[0]&&x===s[1]||(t.props.onScale({target:M,scale:[y,x],dist:[y/s[0],x/s[1]],delta:[y-s[0],x-s[1]],transform:u+" scale("+y+", "+x+")",clientX:r,clientY:o}),t.updateTarget())}function scaleEnd(t,e){var n=e.isDrag,r=e.clientX,o=e.clientY;t.props.onScaleEnd({target:t.props.target,isDrag:n,clientX:r,clientY:o}),n&&t.updateRect()}function getRotateInfo(t,e,n,r){var o=t.startAbsoluteOrigin,i=t.startDeg,a=t.prevDeg,s=t.loop,l=t.direction,c=throttle(getRad(o,[e,n])/Math.PI*180,r);c<a&&270<a&&c<90?++t.loop:a<c&&a<90&&270<c&&--t.loop;var p=360*s+a,u=360*t.loop+c;return t.prevDeg=c,{delta:l*(u-p),dist:l*(u-i),beforeDelta:u-p,beforeDist:u-i,origin:origin}}function rotateStart(t,e){var n=e.datas,r=e.clientX,o=e.clientY,i=t.props.target;if(!i)return!1;var a=t.state,s=a.left,l=a.top,c=a.origin,p=a.rotationPos,u=a.direction,d=a.targetTransform;n.transform=d,n.left=s,n.top=l,n.startAbsoluteOrigin=[r-p[0]+c[0],o-p[1]+c[1]],n.prevDeg=getRad(n.startAbsoluteOrigin,[r,o])/Math.PI*180,n.startDeg=n.prevDeg,n.loop=0,n.direction=u,"none"===n.transform&&(n.transform=""),t.props.onRotateStart({target:i,clientX:r,clientY:o})}function rotate(t,e){var n=e.datas,r=e.clientX,o=e.clientY,i=getRotateInfo(n,r,o,t.props.throttleRotate),a=i.delta,s=i.dist,l=i.beforeDist,c=i.beforeDelta;a&&(t.props.onRotate({target:t.props.target,delta:a,dist:s,clientX:r,clientY:o,beforeDist:l,beforeDelta:c,transform:n.transform+" rotate("+s+"deg)"}),t.updateTarget())}function rotateEnd(t,e){var n=e.isDrag,r=e.clientX,o=e.clientY;t.props.onRotateEnd({clientX:r,clientY:o,target:t.props.target,isDrag:n}),n&&t.updateRect()}function resizeStart(t,e,n){var r=n.datas,o=n.clientX,i=n.clientY,a=t.props.target;if(!a||!e)return!1;var s=getSize(a),l=s[0],c=s[1];dragStart(t,{datas:r}),r.position=e,r.width=l,r.height=c,r.prevWidth=0,r.prevHeight=0,t.props.onResizeStart({target:a,clientX:o,clientY:i})}function resize(t,e){var n=e.datas,r=e.clientX,o=e.clientY,i=e.distX,a=e.distY,s=n.position,l=n.width,c=n.height,p=n.prevWidth,u=n.prevHeight,d=getDragDist({datas:n,distX:i,distY:a}),f=s[0]*d[0],g=s[1]*d[1];if(t.props.keepRatio&&s[0]&&s[1]&&l&&c){var m=Math.sqrt(f*f+g*g),h=getRad([0,0],d),v=getRad([0,0],s),b=Math.cos(h-v)*m;g=(f=b)*c/l}var y=t.props.throttleResize,x=l+(f=throttle(f,y)),M=c+(g=throttle(g,y)),S=[f-p,g-u];n.prevWidth=f,n.prevHeight=g,S.every(function(t){return!t})||(t.props.onResize({target:t.props.target,width:x,height:M,dist:[f,g],delta:S,clientX:r,clientY:o}),t.updateRect())}function resizeEnd(t,e){var n=e.isDrag,r=e.clientX,o=e.clientY;t.props.onScaleEnd({target:t.props.target,clientX:r,clientY:o,isDrag:n}),n&&t.updateRect()}function getTriangleRad(t,e,n){var r=getRad(t,e),o=getRad(t,n)-r;return 0<=o?o:o+2*Math.PI}function isValidPos(t,e){var n=getTriangleRad(t[0],t[1],t[2]),r=getTriangleRad(e[0],e[1],e[2]),o=Math.PI;return!(o<=n&&r<=o||n<=o&&o<=r)}function warpStart(t,e,n){var r=n.datas,o=n.clientX,i=n.clientY,a=t.props.target;if(!e||!a)return!1;var s=t.state,l=s.transformOrigin,c=s.is3d,p=s.targetTransform,u=s.targetMatrix,d=s.width,f=s.height;r.targetTransform=p,r.targetMatrix=c?u:convertDimension(u,3,4),r.targetInverseMatrix=ignoreDimension(invert(r.targetMatrix,4),3,4),r.position=e,dragStart(t,{datas:r}),r.poses=[[0,0],[d,0],[0,f],[d,f]].map(function(t,e){return minus(t,l)}),r.nextPoses=r.poses.map(function(t){var e=t[0],n=t[1];return caculate(r.targetMatrix,[e,n,0,1],4)}),r.posNum=(-1===e[0]?0:1)+(-1===e[1]?0:2),r.prevMatrix=createIdentityMatrix(4),t.props.onWarpStart({target:a,clientX:o,clientY:i})}function warp$1(t,e){var n=e.datas,r=e.clientX,o=e.clientY,i=e.distX,a=e.distY,s=n.posNum,l=n.poses,c=n.targetInverseMatrix,p=n.prevMatrix,u=t.props.target,d=getDragDist({datas:n,distX:i,distY:a},!0),f=n.nextPoses.slice();if(f[s]=[f[s][0]+d[0],f[s][1]+d[1]],NEARBY_POS.every(function(t){return isValidPos(t.map(function(t){return l[t]}),t.map(function(t){return f[t]}))})){var g=warp(l[0],l[1],l[2],l[3],f[0],f[1],f[2],f[3]);if(g.length){var m=convertMatrixtoCSS(multiply(c,g,4)),h=n.targetTransform+" matrix3d("+m.join(",")+")",v=multiply(invert(p,4),m,4);n.prevMatrix=m,t.props.onWarp({target:u,clientX:r,clientY:o,delta:v,multiply:multiplyCSS,dist:m,transform:h}),t.updateRect()}}}function warpEnd(t,e){var n=e.isDrag,r=e.clientX,o=e.clientY;t.props.onWarpEnd({target:t.props.target,clientX:r,clientY:o,isDrag:n}),n&&t.updateRect()}function getMoveableDragger(s,t){var l;return drag.drag(t,{container:window,dragstart:function(t){var e=t.datas,n=t.inputEvent,r=t.clientX,o=t.clientY,i=n.target;if(l="",!utils.hasClass(i,prefix("control")))return!1;if(utils.hasClass(i,prefix("rotation")))return l="rotate",rotateStart(s,{datas:e,clientX:r,clientY:o});if(s.props.scalable){var a=getPosition(i);return l="scale",scaleStart(s,a,{datas:e,clientX:r,clientY:o})}if(s.props.resizable){a=getPosition(i);return l="resize",resizeStart(s,a,{datas:e,clientX:r,clientY:o})}if(s.props.warpable){a=getPosition(i);return l="warp",warpStart(s,a,{datas:e,clientX:r,clientY:o})}return!1},drag:function(t){if(l)return"rotate"===l?rotate(s,t):"scale"===l?scale(s,t):"resize"===l?resize(s,t):"warp"===l?warp$1(s,t):void 0},dragend:function(t){var e=t.isDrag,n=t.clientX,r=t.clientY;if(l)return"rotate"===l?rotateEnd(s,{isDrag:e,clientX:n,clientY:r}):"scale"===l?scaleEnd(s,{isDrag:e,clientX:n,clientY:r}):"resize"===l?resizeEnd(s,{isDrag:e,clientX:n,clientY:r}):"warp"===l?warpEnd(s,{isDrag:e,clientX:n,clientY:r}):void 0}})}var ControlBoxElement=styled("div",MOVEABLE_CSS),Moveable=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={target:null,beforeMatrix:createIdentityMatrix(3),matrix:createIdentityMatrix(3),targetTransform:"",targetMatrix:createIdentityMatrix(3),is3d:!1,left:0,top:0,width:0,height:0,transformOrigin:[0,0],direction:1,rotationRad:0,rotationPos:[0,0],origin:[0,0],pos1:[0,0],pos2:[0,0],pos3:[0,0],pos4:[0,0]},t}__extends$3(t,e);var n=t.prototype;return n.isMoveableElement=function(t){return t&&-1<(t.getAttribute("class")||"").indexOf(PREFIX)},n.render=function(){this.state.target!==this.props.target&&this.updateRect(!0);var t=this.state,e=t.left,n=t.top,r=t.pos1,o=t.pos2,i=t.pos3,a=t.pos4,s=t.target,l=t.direction;return createElement(ControlBoxElement,{ref:frameworkUtils.ref(this,"controlBox"),className:prefix("control-box",-1===l?"reverse":""),style:{position:this.props.container?"absolute":"fixed",display:s?"block":"none",transform:"translate("+e+"px, "+n+"px) translateZ(50px)"}},createElement("div",{className:prefix("line"),style:getLineStyle(r,o)}),createElement("div",{className:prefix("line"),style:getLineStyle(o,a)}),createElement("div",{className:prefix("line"),style:getLineStyle(r,i)}),createElement("div",{className:prefix("line"),style:getLineStyle(i,a)}),this.renderRotation(),this.renderPosition(),this.renderMiddleLine(),this.renderDiagonalPosition(),this.renderOrigin())},n.renderRotation=function(){if(!this.props.rotatable)return null;var t=this.state,e=t.pos1,n=t.pos2,r=t.rotationRad;return createElement("div",{className:prefix("line rotation"),style:{transform:"translate("+(e[0]+n[0])/2+"px, "+(e[1]+n[1])/2+"px) translateY(-40px) rotate("+r+"rad)"}},createElement("div",{className:prefix("control","rotation"),ref:frameworkUtils.ref(this,"rotationElement")}))},n.renderOrigin=function(){if(!this.props.origin)return null;var t=this.state.origin;return createElement("div",{className:prefix("control","origin"),style:getControlTransform(t)})},n.renderDiagonalPosition=function(){var t=this.props,e=t.resizable,n=t.scalable,r=t.warpable;if(!e&&!n&&!r)return null;var o=this.state,i=o.pos1,a=o.pos2,s=o.pos3,l=o.pos4;return[createElement("div",{className:prefix("control","nw"),"data-position":"nw",key:"nw",style:getControlTransform(i)}),createElement("div",{className:prefix("control","ne"),"data-position":"ne",key:"ne",style:getControlTransform(a)}),createElement("div",{className:prefix("control","sw"),"data-position":"sw",key:"sw",style:getControlTransform(s)}),createElement("div",{className:prefix("control","se"),"data-position":"se",key:"se",style:getControlTransform(l)})]},n.renderMiddleLine=function(){var t=this.props,e=t.resizable,n=t.scalable,r=t.warpable;if(!e&&!n&&r){var o=this.state,i=o.pos1,a=o.pos2,s=o.pos3,l=o.pos4,c=i.map(function(t,e){return utils.dot(t,a[e],1,2)}),p=i.map(function(t,e){return utils.dot(t,a[e],2,1)}),u=i.map(function(t,e){return utils.dot(t,s[e],1,2)}),d=i.map(function(t,e){return utils.dot(t,s[e],2,1)}),f=s.map(function(t,e){return utils.dot(t,l[e],1,2)}),g=s.map(function(t,e){return utils.dot(t,l[e],2,1)}),m=a.map(function(t,e){return utils.dot(t,l[e],1,2)}),h=a.map(function(t,e){return utils.dot(t,l[e],2,1)});return[createElement("div",{className:prefix("line"),key:"middeLine1",style:getLineStyle(c,f)}),createElement("div",{className:prefix("line"),key:"middeLine2",style:getLineStyle(p,g)}),createElement("div",{className:prefix("line"),style:getLineStyle(u,m)}),createElement("div",{className:prefix("line"),style:getLineStyle(d,h)})]}},n.renderPosition=function(){if(!this.props.resizable&&!this.props.scalable)return null;var t=this.state,e=t.pos1,n=t.pos2,r=t.pos3,o=t.pos4;return[createElement("div",{className:prefix("control","n"),"data-position":"n",key:"n",style:getControlTransform(e,n)}),createElement("div",{className:prefix("control","w"),"data-position":"w",key:"w",style:getControlTransform(e,r)}),createElement("div",{className:prefix("control","e"),"data-position":"e",key:"e",style:getControlTransform(n,o)}),createElement("div",{className:prefix("control","s"),"data-position":"s",key:"s",style:getControlTransform(r,o)})]},n.componentDidMount=function(){this.moveableDragger=getMoveableDragger(this,this.controlBox.getElement())},n.componentWillUnmount=function(){this.draggableDragger&&(this.draggableDragger.unset(),this.draggableDragger=null),this.moveableDragger&&(this.moveableDragger.unset(),this.moveableDragger=null)},n.move=function(t){if(t[0]||t[1]){var e=this.state,n=e.left,r=e.top;this.setState({left:n+t[0],top:r+t[1]})}},n.updateRect=function(t){var e=this.props.target;this.state.target!==e&&(this.draggableDragger&&(this.draggableDragger.unset(),this.draggableDragger=null),e&&this.props.draggable&&(this.draggableDragger=getDraggableDragger(this,e)));var n=this.props.container;this.updateState(getTargetInfo(e,n),t)},n.updateTarget=function(){var t=this.state,e=t.width,n=t.height,r=t.beforeMatrix,o=caculateMatrixStack(this.props.target,this.props.container,!0,r,16===r.length?4:3),i=o[1],a=o[2],s=o[3],l=o[4],c=caculatePosition(i,l,e,n),p=c[0],u=p[0],d=p[1],f=c[1],g=c[2],m=c[3],h=c[4],v=c[5],b=getRotationInfo(g,m,h,v),y=b[0],x=b[1],M=b[2];this.setState({direction:y,rotationRad:x,rotationPos:M,pos1:g,pos2:m,pos3:h,pos4:v,origin:f,beforeMatrix:r,targetMatrix:a,matrix:i,transformOrigin:l,targetTransform:s,left:u,top:d})},n.updateState=function(t,e){var n=this.state;if(e)for(var r in t)n[r]=t[r];else this.setState(t)},t.defaultProps={target:null,container:null,rotatable:!1,draggable:!1,scalable:!1,resizable:!1,warpable:!1,keepRatio:!0,origin:!0,throttleDrag:0,throttleResize:0,throttleScale:0,throttleRotate:0,onRotateStart:function(){},onRotate:function(){},onRotateEnd:function(){},onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},onScaleStart:function(){},onScale:function(){},onScaleEnd:function(){},onResizeStart:function(){},onResize:function(){},onResizeEnd:function(){},onWarpStart:function(){},onWarp:function(){},onWarpEnd:function(){}},t}(PureComponent),InnerMoveable=function(n){function t(t){var e=n.call(this,t)||this;return e.state={},e.state=e.props,e}return __extends(t,n),t.prototype.render=function(){return h(Moveable,__assign({ref:frameworkUtils.ref(this,"preactMoveable")},this.state))},t}(Component),Moveable$1=function(o){function t(t,e){void 0===e&&(e={});var n=o.call(this)||this;n.onDragStart=function(t){n.trigger("dragStart",t)},n.onDrag=function(t){n.trigger("drag",t)},n.onDragEnd=function(t){n.trigger("dragEnd",t)},n.onResizeStart=function(t){n.trigger("resizeStart",t)},n.onResize=function(t){n.trigger("resize",t)},n.onResizeEnd=function(t){n.trigger("resizeEnd",t)},n.onScaleStart=function(t){n.trigger("scaleStart",t)},n.onScale=function(t){n.trigger("scale",t)},n.onScaleEnd=function(t){n.trigger("scaleEnd",t)},n.onRotateStart=function(t){n.trigger("rotateStart",t)},n.onRotate=function(t){n.trigger("rotate",t)},n.onRotateEnd=function(t){n.trigger("rotateEnd",t)},n.onWarpStart=function(t){n.trigger("warpStart",t)},n.onWarp=function(t){n.trigger("warp",t)},n.onWarpEnd=function(t){n.trigger("warpEnd",t)};var r=document.createElement("div");return render(h(InnerMoveable,__assign({ref:frameworkUtils.ref(n,"innerMoveable")},e,{onDragStart:n.onDragStart,onDrag:n.onDrag,onDragEnd:n.onDragEnd,onResizeStart:n.onResizeStart,onResize:n.onResize,onResizeEnd:n.onResizeEnd,onScaleStart:n.onScaleStart,onScale:n.onScale,onScaleEnd:n.onScaleEnd,onRotateStart:n.onRotateStart,onRotate:n.onRotate,onRotateEnd:n.onRotateEnd,onWarpStart:n.onWarpStart,onWarp:n.onWarp,onWarpEnd:n.onWarpEnd})),r),t.appendChild(r.children[0]),n}__extends(t,o);var e=t.prototype;return Object.defineProperty(e,"origin",{get:function(){return this.getMoveableProps().origin},set:function(t){this.innerMoveable.setState({origin:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"target",{get:function(){return this.getMoveableProps().target},set:function(t){t!==this.target?this.innerMoveable.setState({target:t}):this.updateRect()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"draggable",{get:function(){return this.getMoveableProps().draggable||!1},set:function(t){this.innerMoveable.setState({draggable:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"resizable",{get:function(){return this.getMoveableProps().resizable},set:function(t){this.innerMoveable.setState({resizable:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scalable",{get:function(){return this.getMoveableProps().scalable},set:function(t){this.innerMoveable.setState({scalable:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"rotatable",{get:function(){return this.getMoveableProps().rotatable},set:function(t){this.innerMoveable.setState({rotatable:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"warpable",{get:function(){return this.getMoveableProps().warpable},set:function(t){this.innerMoveable.setState({warpable:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"keepRatio",{get:function(){return this.getMoveable().props.keepRatio},set:function(t){this.innerMoveable.setState({keepRatio:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"throttleDrag",{get:function(){return this.getMoveable().props.throttleDrag},set:function(t){this.innerMoveable.setState({throttleDrag:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"throttleResize",{get:function(){return this.getMoveable().props.throttleResize},set:function(t){this.innerMoveable.setState({throttleResize:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"throttleScale",{get:function(){return this.getMoveable().props.throttleScale},set:function(t){this.innerMoveable.setState({throttleScale:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"throttleRotate",{get:function(){return this.getMoveable().props.throttleRotate},set:function(t){this.innerMoveable.setState({throttleRotate:t})},enumerable:!0,configurable:!0}),e.move=function(t){this.getMoveable().move(t)},e.isMoveableElement=function(t){return this.getMoveable().isMoveableElement(t)},e.updateRect=function(){this.getMoveable().updateRect()},e.updateTarget=function(){this.getMoveable().updateTarget()},e.destroy=function(){var t=this.getMoveable().base;t.remove?t.remove():t.parentElement.removeChild(t),this.innerMoveable=null,this.getMoveable().componentWillUnmount()},e.getMoveable=function(){return this.innerMoveable.preactMoveable},e.getMoveableProps=function(){return this.getMoveable().props},t}(EgComponent);exports.default=Moveable$1;
//# sourceMappingURL=moveable.esm.test.js.map
